#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct equipment
{
    char ID[10];            //设备ID
    char name[20];      //设备名称
    char kind[20];          //设备种类
    char over[20];          //设备报废日期
    char scrap[10];         //设备是否报废
    char date[10];          //设备生产时间
    char price[10];         //设备价格
};

typedef struct node
{
    struct equipment data;
    struct node *next;
}Node;

void fscanfEquipment(Node *equip)      //将设备信息输入文件
{
    FILE *fp = fopen("equipment.txt","w");
    Node *current = equip->next;
    while(current){
        fprintf(fp,"%s\t",current->data.ID);
        fprintf(fp,"%s\t",current->data.name);
        fprintf(fp,"%s\t",current->data.kind);
        fprintf(fp,"%s\t",current->data.over);
        fprintf(fp,"%s\t",current->data.scrap);
        fprintf(fp,"%s\t",current->data.date);
        fprintf(fp,"%s\t\n",current->data.price);
        current = current->next;
    }
    fclose(fp);
}

Node *fprintfEquipment()
{
    FILE* fp;
    fp = fopen("equipment.txt","r");

    Node *head = (Node *)malloc(sizeof(Node));
    Node* pre = head;

    while(!feof(fp)){
        Node *newnode = (Node*)malloc(sizeof(Node));
        fscanf(fp,"%s",newnode->data.ID);
        fscanf(fp,"%s",newnode->data.name);
        fscanf(fp,"%s",newnode->data.kind);
        fscanf(fp,"%s",newnode->data.over);
        fscanf(fp,"%s",newnode->data.date);
        fscanf(fp,"%s",newnode->data.scrap);
        fscanf(fp,"%s",newnode->data.price);
        pre->next = newnode;
        pre = newnode;
    }
    pre->next = NULL;
    fclose(fp);
    return head;
}

void addEquipment(Node *equip)          //添加设备记录
{
    Node *p,*r;
    char id[10];            //输入设备的ID
    r = equip;
    while(r->next != NULL)
        r = r->next;
    while(1){
        printf(">>>>>>>>>>提示:输入0则返回主菜单!\n");
        printf("\n请你输入设备ID号:");
        scanf("%s",id);
        if(strcmp(id,"0") == 0)
            break;
//        if(checkID(equip,id)){
//            printf("输入的编号已经存在，输入失败");
//            return;
//        }
        p=(Node *)malloc(sizeof(Node));
        strcpy(p->data.ID,id);
        printf("\n请输入设备种类:");
        scanf("%s",p->data.kind);
        printf("\n请输入设备名称:");
        scanf("%s",p->data.name);
        printf("\n请输入设备价格:");
        scanf("%s",p->data.price);
        printf("\n请输入设备购入日期:");
        scanf("%s",&p->data.date);
        printf("\n设备是否报废:");
        scanf("%s",&p->data.scrap);
        printf("\n设备报废日期:");
        scanf("%s",&p->data.over);
        p->next = NULL;
        r->next = p;
        r = p;
        fscanfEquipment(equip);
        printf(">>>>>>>>>>提示:成功添加一条记录。\n");
    }
}

void deleteEquipment(Node *equip)       //删除设备信息
{
    Node *p,*r,*s;
    char id[10];
    int x;
    r = equip;
    s = equip->next;
    if(equip->next == NULL){
        printf("\n>>>>>>>>>>提示:没有资料可以修改!\n");
        return ;
    }
    while(1){
        printf(">>>>>>>>>>提示:输入0则返回主菜单!\n");
        scanf("%d",&x);
            if(x == 0)
                break;
        printf("\n请你输入要删除的设备ID号:");
        scanf("%s",id);
        if(strcmp(s->data.ID,id) == 0){
            r->next = s->next;
            r = r->next;
            free(s);
            printf(">>>>>>>>>>提示:成功删除一条记录。\n");
            fscanfEquipment(equip);
        }else{
            r = s;
            s = s->next;
        }
    }
}

void updateEquipment(Node *equip)       //更新设备信息
{
    Node *p;
    char find[20];
    if(equip->next == NULL){
        printf("\n>>>>>>>>>>提示:没有资料可以修改!\n");
        return ;
    }
    printf("请输入要修改的设备ID号:");
    scanf("%s",find);
    p = equip->next;
    while(p != NULL){
        if(strcmp(p->data.ID,find) == 0)
            break;
        p = p->next;
    }
    if(p){
        int x;
        while(1){
            printf("完成修改请输入0否则输入任意数再进行修改:");
            scanf("%d",&x);
            if(x == 0)
                break;
            printf("请输入新设备号(原来是 %s ):",p->data.ID);
           scanf("%s",p->data.ID);
           printf("请输入新设备名称(原来是 %s ):",p->data.name);
           scanf("%s",p->data.name);
           printf("请输入新设备设备种类名称(原来是 %s ):",p->data.kind);
           scanf("%s",p->data.kind);
           printf("请输入新设备报废日期名称(原来是 %s ):",p->data.over);
           scanf("%s",p->data.over);
           printf("请输入新设备是否报废(原来是 %s ):",p->data.scrap);
           scanf("%s",p->data.scrap);
           printf("请输入新设备购买时间(原来是 %s ):",p->data.kind);
           scanf("%s",p->data.date);
           printf("请输入新设备价格(原来是 %s ):",p->data.price);
           scanf("%s",p->data.price);
           printf("\n>>>>>>>>>>提示:该项记录资料已经成功修改!\n");
           fscanfEquipment(equip);
        }
    }else{
        printf("\n>>>>>>>>>>提示:你要修改的信息不存在!\n");
    }
}

void printEquipment(Node *equip)
{
    Node *p;
    p = equip->next;
    if(p == NULL){
        printf("\n>>>>>>>>>>提示:没有记录可以显示!\n");
        return;
    }
    printf("\t\t\t\t显示结果\n");
    printf("设备号   设备名称   设备种类   报废日期   是否报废   购买时间   价格\n");
    while(p){
        printf("\n%-13s%-11s%-7s%-10s%-13s%-10s%-5s\n",p->data.ID,p->data.name,p->data.kind,p->data.over,p->data.scrap,p->data.date,p->data.price);
    p=p->next;
    }
}

void classifyEquipment(Node *equip)
{
    Node *p;
    int sel;
    int flag2 = 0,ha = 0;
    p = equip->next;
    char find[20];
    if(equip->next == NULL)
    {
        printf("\n>>>>>>>>>>提示:没有资料可以统计分类!\n");
        return ;
    }
    printf(">>>>>>>>>>提示:\n>0退出\n>1按设备号统计\n>2按设备名称统计\n");
    scanf("%d",&sel);
    if(sel == 1){
        printf("\n输入你要统计分类的设备号:");
        scanf("%s",find);
        while(p){
            if(strcmp(p->data.ID,find)==0){
                flag2++;
            }
            if(flag2 == 1 && ha!=flag2){
                printf("设备号   设备名称   设备种类   报废日期   是否报废   购买时间   价格\n");
                printf("\n%-13s%-11s%-7s%-10s%-13s%-10s%-5s\n",p->data.ID,p->data.name,p->data.kind,p->data.over,p->data.scrap,p->data.date,p->data.price);
                ha = flag2;
            }else if(flag2 > ha){
                printf("\n%-13s%-11s%-7s%-10s%-13s%-10s%-5s\n",p->data.ID,p->data.name,p->data.kind,p->data.over,p->data.scrap,p->data.date,p->data.price);
                ha = flag2;
            }
            p = p->next;
        }
        if(flag2){
            printf("\n*************************按设备号%s统计分类的有%d条记录:*************************\n\n",find,flag2);
        }else{
            printf("\n按设备号%s统计的结果为0个\n\n",find);
        }
    }else if(sel == 2){
        printf("\n输入你要统计分类的设备名称:");
        scanf("%s",find);
        while(p){
            if(strcmp(p->data.name,find)==0){
                flag2++;
            }
            if(flag2 == 1 && ha!=flag2){
                printf("设备号   设备名称   设备种类   报废日期   是否报废   购买时间   价格\n");
                printf("\n%-13s%-11s%-7s%-10s%-13s%-10s%-5s\n",p->data.ID,p->data.name,p->data.kind,p->data.over,p->data.scrap,p->data.date,p->data.price);
                ha = flag2;
            }else if(flag2 > ha){
                printf("\n%-13s%-11s%-7s%-10s%-13s%-10s%-5s\n",p->data.ID,p->data.name,p->data.kind,p->data.over,p->data.scrap,p->data.date,p->data.price);
                ha = flag2;
            }
            p = p->next;
        }
        if(flag2){
            printf("\n*************************按设备号%s统计分类的有%d条记录:*************************\n\n",find,flag2);
        }else{
            printf("\n按设备号%s统计的结果为0个\n\n",find);
        }
    }else if(sel == 0)
        return;
}

//int checkID(Node *equip,char num)
//{
//    Node *current = equip->next;
//    while(current){
//        if(strcmp(current->data.ID,num[10])){
//            return 1;
//        }
//        current = current->next;
//    }
//    return 0;
//}

/**                           页面布局板块                                 **/

/**打印制定数量的空格**/
void printBlank(int n)
{
    int i;
    for(i=0;i<=n;i++)
        putchar(' ');
}

/**打印一行指定字符**/
void printLine(char c, int n)
{
    int i;
    for(i=0;i<=n;i++)
        putchar(c);
        printf("\n");
}

/**系统标题页面**/
void title()
{
    printBlank(20);printLine('=', 60);printBlank(20);
    printf("☆");
    printBlank(17);printf("**实验设备管理系统**");printBlank(18);printf("☆\n");
    printBlank(20);printf("☆");printBlank(56);printf("☆\n");
    printBlank(20);printf("☆");printBlank(56);printf("☆\n");
    printBlank(20);printf("☆");printBlank(15);printf("Author:罗明  Teacher:化志章  Version:v1.0");printf("☆\n");
    printBlank(20);printLine('=', 60);
}

void  meau()
{
    printBlank(20);
    printf("1->添加实验设备信息");
    printBlank(20);
    printf("2->删除实验设备信息");
    printf("\n");
    printBlank(20);
    printf("3->修改实验设备信息");
    printBlank(20);
    printf("4->显示实验设备信息");
    printf("\n");
    printBlank(20);
    printf("5->设备信息统计分类");
    printBlank(20);
    printf("0->返回主目录");
    printf("\n");
    printf("\n");
}

void main()
{
    Node *equip;
    equip = fprintfEquipment();
    int flag;
    title();
    while(1){
        meau();
        printf("请输入你要操作的序号:");
        scanf("%d",&flag);
        switch(flag)
        {
        case 0:
            printf("\n>>>>>>>>>>提示:已经退出系统,ByeBye!\n");
            break;
        case 1:
            addEquipment(equip);
            break; //增加记录
        case 2:
            deleteEquipment(equip);
            break;//删除记录
        case 3:
            updateEquipment(equip);
            break;//修改记录
        case 4:
            printEquipment(equip);
            break;//显示记录信息
        case 5:
          classifyEquipment(equip);
            break;//统计记录
        default:
            printf("\n>>>>>>>>>>提示:输入错误!\n");
            break;
        }
    }
}
